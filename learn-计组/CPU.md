## 5.4 控制器

###  控制器的功能和结构

<img src="../assets/image-20210312115356133.png" alt="image-20210312115356133" style="zoom:80%;" />

1.  取指令，指向下一条指令
2.  对指令译码，产生控制信号
3.  指挥数据流动方向

![image-20210312103508704](../assets/image-20210312103508704.png)

#### 控制单元的输入和输出

1.  输入

    指令寄存器

    时钟

    标志

    外来信号

2.  输出

    cpu内部的控制信号

    到控制总线的控制信号

### CU的设计

#### 硬布线控制器

IR对组合逻辑不友好，IR是二进制编码，一个编码对应一个状态而CU是一个位对于一个状态，因此需要操作码译码器

通常以存取周期作为基准时间，即机器周期

##### 设计步骤

1.  分析微操作序列
2.  选择CPU的控制方式---产生不同微操作命令序列所有的时许控制方式
    1.  同步控制方式--来自一个统一的时钟信号，控制电路简单，运行速度慢
    2.  异步控制方式---通过应答方式进行联络，运行快，控制电路复杂
    3.  联合控制方式，大部分采用同步控制，小部分用异步控制
3.  安排微操作时序

<img src="../assets/image-20210312104631388.png" alt="image-20210312104631388" style="zoom:50%;" />

ps:中断周期三个任务：1.保存端点；2.形成中断服务程序的入口地址；3.关中断

电路设计

​	组合逻辑设计

​	设计步骤；1.列出操作时间表；2.写出微操作的最简单表达式；3.画出逻辑图

#### 微程序

<img src="../assets/image-20210312111811780.png" alt="image-20210312111811780" style="zoom:50%;" />

**基本思想：将微操作控制信号存储在一个专门的存储器中，用寻址的方法找到指令**

微命令=微操作的控制信号，微操作=微命令的执行过程

相容性微命令与互斥性微命令

**基本机构**

<img src="../assets/image-20210312112121333.png" alt="image-20210312112121333" style="zoom:80%;" />

 

CM:

![image-20210312112707012](../assets/image-20210312112707012.png)

微指令的格式

1.  水平型微指令：一次定义并执行多个平行操作

    ![image-20210312112832076](../assets/image-20210312112832076.png)

    

2.  垂直型微指令 

    ![image-20210312112844142](../assets/image-20210312112844142.png)

3.  混合型微指令

如何表示一系列控制信号

1.  直接编码--一个为代表微操作命令

2.  字段直接编码--将控制字段分成n个段，将段译码后发出控制信号

    <img src="../assets/image-20210312113405355.png" alt="image-20210312113405355" style="zoom:50%;" />

    字段分段原则；1.互斥在同段，相容不同段；2. 段中位不能大多；3. 每段保留一个状态码

    优点：缩短字长

    缺点：运行慢

3.  字段间接编码

4.  <img src="../assets/image-20210312113455293.png" alt="image-20210312113455293" style="zoom:50%;" />



微指令的地址形成方式<img src="../assets/image-20210312113808955.png" alt="image-20210312113808955" style="zoom:80%;" />

**断定方式**

<img src="../assets/image-20210312114034262.png" alt="image-20210312114034262" style="zoom:67%;" />

##### 微程序控制单元的设计

步骤：1.分析微操作序列；2.写出微操作命令以及节拍安排；3.确定微指令格式；4.编写微指令码点

PS![image-20210312114751876](../assets/image-20210312114751876.png)

##### **微程序控制的基本概念**

<img src="../assets/image-20210312114343809.png" alt="image-20210312114343809" style="zoom:67%;" />

![image-20210312114906660](../assets/image-20210312114906660.png)

#### 硬布线与微程序的比较

![image-20210312114944096](../assets/image-20210312114944096.png)

#### 指令流水线

为了解决指令工作速度

定义；取指，分析，执行

##### 执行方式

![image-20210313081335694](F:\造轮子\计算机学习\assets\image-20210313081626463.png)

![image-20210313081535952](F:\造轮子\计算机学习\assets\image-20210313081535952.png)

![image-20210313081635016](F:\造轮子\计算机学习\assets\image-20210313081635016.png)

##### 流水线的表示方法

![image-20210313081803535](F:\造轮子\计算机学习\assets\image-20210313081803535.png)

##### 流水线的性能指标

1.  吞吐率TP

    ![image-20210313082147903](../assets/image-20210313082147903.png)

2.  加速比S-----不使用流水线时间与使用流水线时间之比

    ![image-20210313082313707](../assets/image-20210313082313707.png)

3.  效率E

    ![image-20210313082451289](../assets/image-20210313082451289.png)

##### 流水线的影响因素

1.  结构相关(资源冲突)----在同一时间争用同一资源而形成的冲突

    解决方法：1. 后一相关指令暂停一个周期；2. 资源重复配置：数据存储器+指令存储器

2.  数据相关（数据冲突）----使用同一个数据时，存在前后指令必须按顺序执行的情况

    暂停后续指令n个周期，1.使用硬件阻塞和软件插入NOP；2.数据旁路技术；3.编译优化

    冲突基本类型：RAW，WAR，WAW

3.  控制相关（控制冲突）-----流水线遇到转移指令和其他改变的PC值的指令而造成断流

    解决方法：1. 尽早实现转移，2.

##### 流水线分类

流水线使用的级别------部件，处理机，处理机间

完成功能-------单功能，多功能

按同一时间各段的连接方式------动态，静态



流水线多发技术

1.  超标量技术

2.  超流水技术
3.  超长指令字